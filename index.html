<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-0463493221079646">
    <title>TTK Calculator Pro - Daniel Delgado</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0463493221079646" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #ddd;
            text-align: center;
        }
        h1 { font-size: 28px; color: #00ccff; }
        h2 { font-size: 20px; color: #00ff99; margin: 10px 0; }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .input-group {
            display: inline-block;
            margin: 10px;
            vertical-align: top;
        }
        label { display: block; margin-bottom: 5px; color: #bbb; }
        input, select {
            padding: 8px;
            width: 80px;
            font-size: 14px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #333;
            color: #fff;
        }
        button {
            padding: 10px 20px;
            background: #00ccff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0099cc; }
        #resetBtn { background: #ff4444; }
        #resetBtn:hover { background: #cc3333; }
        #result { margin: 20px 0; font-size: 20px; color: #00ff99; }
        #theoreticalTTK { font-size: 16px; color: #ffcc00; margin-top: 10px; }
        #stats { font-size: 14px; color: #ddd; margin-top: 10px; text-align: left; display: inline-block; }
        #chartExplanation { font-size: 14px; color: #bbb; margin-top: 10px; max-width: 600px; margin-left: auto; margin-right: auto; }
        canvas { max-width: 100%; margin: 20px 0; }
        .donate a { color: #00ccff; font-weight: bold; text-decoration: none; }
        @media (max-width: 500px) {
            input, select { width: 60px; }
            .input-group { margin: 5px; }
            h1 { font-size: 22px; }
        }
    </style>
    
</head>
<body>
    <h1>TTK Calculator Pro</h1>
    <div class="section">
        <h2>Shooter</h2>
        <div class="input-group">
            <label>Precisión (%):</label>
            <input type="number" id="accuracy" min="0" max="100" value="100">
        </div>
        <div class="input-group">
            <label>Reducción Dispersión (%):</label>
            <input type="number" id="spreadReduction" min="0" max="100" value="0">
        </div>
        <div class="input-group">
            <label>Daño Boost (%):</label>
            <input type="number" id="damageBoost" min="0" value="0">
        </div>
        <div class="input-group">
            <label>Fire Rate Boost (%):</label>
            <input type="number" id="fireRateBoost" min="0" value="0">
        </div>
        <div class="input-group">
            <label>Reducción Recarga (%):</label>
            <input type="number" id="reloadReduction" min="0" max="100" value="0">
        </div>
        <div class="input-group">
            <label>Munición Boost (%):</label>
            <input type="number" id="ammoBoost" min="0" value="0">
        </div>
    </div>
    <div class="section">
        <h2>Arma</h2>
        <div class="input-group">
            <label>Daño:</label>
            <input type="number" id="damage" min="1" value="10">
        </div>
        <div class="input-group">
            <label>Fire Rate:</label>
            <input type="number" id="fireRate" min="1" value="60">
            <select id="fireRateUnit">
                <option value="rpm">RPM</option>
                <option value="rps">RPS</option>
            </select>
        </div>
        <div class="input-group">
            <label>Dispersión (grados):</label>
            <input type="number" id="spread" min="0" value="0">
        </div>
        <div class="input-group">
            <label>Munición:</label>
            <input type="number" id="clipAmmo" min="1" value="30">
        </div>
        <div class="input-group">
            <label>Tiempo Recarga (s):</label>
            <input type="number" id="reloadTime" min="0" step="0.1" value="2">
        </div>
    </div>
    <div class="section">
        <h2>Objetivo</h2>
        <div class="input-group">
            <label>Distancia (m):</label>
            <input type="number" id="distance" min="0" value="10">
        </div>
        <div class="input-group">
            <label>Ancho (m):</label>
            <input type="number" id="width" min="0" step="0.1" value="0.5">
        </div>
        <div class="input-group">
            <label>Alto (m):</label>
            <input type="number" id="height" min="0" step="0.1" value="1.8">
        </div>
        <div class="input-group">
            <label>Salud (HP):</label>
            <input type="number" id="hp" min="1" value="100">
        </div>
        <div class="input-group">
            <label>Armadura:</label>
            <input type="number" id="armor" min="0" value="0">
        </div>
        <div class="input-group">
            <label>Absorción Armadura (%):</label>
            <input type="number" id="armorAbsorption" min="0" max="100" value="0">
        </div>
        <div class="input-group">
            <label>Regen Salud (HP/s):</label>
            <input type="number" id="healthRegen" min="0" step="0.1" value="0">
        </div>
        <div class="input-group">
            <label>Regen Armadura (/s):</label>
            <input type="number" id="armorRegen" min="0" step="0.1" value="0">
        </div>
        <div class="input-group">
            <label>Reducción Daño (%):</label>
            <input type="number" id="damageReduction" min="0" max="100" value="0">
        </div>
    </div>
    <button onclick="calculateTTK()">Calcular TTK</button>
    <button onclick="exportResults()">Exportar JSON</button>
    <button id="resetBtn" onclick="resetData()">Resetear Datos</button>
    <div id="result"></div>
    <div id="theoreticalTTK"></div>
    <div id="stats"></div>
    <canvas id="ttkChart"></canvas>
    <div id="chartExplanation"></div>
    <div class="donate">
        <p>¿Te sirvió? <a href="https://buymeacoffee.com/genio043" target="_blank">Cómprame un té :)</a></p>
    </div>
    <!-- Google Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
            crossorigin="anonymous"></script>
    <ins class="adsbygoogle"
         style="display:block; margin: 20px auto;"
         data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
         data-ad-slot="YYYYYYYYYY"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <script>
        let chart;
        function calculateTTK() {
            // Shooter
            const accuracy = parseFloat(document.getElementById('accuracy').value) / 100;
            const spreadReduction = parseFloat(document.getElementById('spreadReduction').value) / 100;
            const damageBoost = parseFloat(document.getElementById('damageBoost').value) / 100;
            const fireRateBoost = parseFloat(document.getElementById('fireRateBoost').value) / 100;
            const reloadReduction = parseFloat(document.getElementById('reloadReduction').value) / 100;
            const ammoBoost = parseFloat(document.getElementById('ammoBoost').value) / 100;

            // Arma
            const damage = parseFloat(document.getElementById('damage').value);
            let fireRate = parseFloat(document.getElementById('fireRate').value);
            const fireRateUnit = document.getElementById('fireRateUnit').value;
            const spread = parseFloat(document.getElementById('spread').value);
            let clipAmmo = Math.round(parseFloat(document.getElementById('clipAmmo').value) * (1 + ammoBoost));
            let reloadTime = parseFloat(document.getElementById('reloadTime').value) * (1 - reloadReduction);

            // Objetivo
            const distance = parseFloat(document.getElementById('distance').value);
            const width = parseFloat(document.getElementById('width').value);
            const height = parseFloat(document.getElementById('height').value);
            const hp = parseFloat(document.getElementById('hp').value);
            const armor = parseFloat(document.getElementById('armor').value);
            const armorAbsorption = parseFloat(document.getElementById('armorAbsorption').value) / 100;
            const healthRegen = parseFloat(document.getElementById('healthRegen').value);
            const armorRegen = parseFloat(document.getElementById('armorRegen').value);
            const damageReduction = parseFloat(document.getElementById('damageReduction').value) / 100;

            // Validación
            if (damage <= 0 || fireRate <= 0 || clipAmmo <= 0 || hp <= 0) {
                document.getElementById('result').innerHTML = "Valores inválidos (deben ser > 0).";
                document.getElementById('theoreticalTTK').innerHTML = "";
                document.getElementById('stats').innerHTML = "";
                return;
            }

            // Convertir fire rate a RPS
            if (fireRateUnit === 'rpm') fireRate /= 60;
            fireRate *= (1 + fireRateBoost);

            // Hit chance por dispersión
            const effectiveSpread = spread * (1 - spreadReduction);
            const hitChance = effectiveSpread === 0 ? 1 : Math.min(1, (Math.atan2(width, distance) * Math.atan2(height, distance)) / (effectiveSpread * Math.PI / 180));

            // Daño efectivo
            const baseDamage = damage * (1 + damageBoost) * (1 - damageReduction);
            const effectiveDamage = baseDamage * (1 - armorAbsorption) * accuracy * hitChance;
            const dps = effectiveDamage * fireRate;

            // TTK Teórico
            const netDamagePerSecond = dps - (healthRegen + armorRegen * (1 - armorAbsorption));
            const theoreticalTTK = netDamagePerSecond <= 0 ? "∞" : ((hp + armor) / netDamagePerSecond).toFixed(2);
            document.getElementById('theoreticalTTK').innerHTML = `TTK Teórico: ${theoreticalTTK} ${theoreticalTTK === "∞" ? "" : "segundos"}`;

            // Simulación para gráfico y stats (hasta 60s)
            let currentHP = hp;
            let currentArmor = armor;
            let time = 0;
            let shotsFired = 0;
            let secondsFiring = 0;
            let secondsReloading = 0;
            let shotCount = 0;
            let reloadCount = 0;
            let totalDamage = 0;
            const dataPoints = [{ time: 0, hp: currentHP, armor: currentArmor }];
            const timeStep = 0.1;

            while (currentHP > 0 && time < 60) {
                time += timeStep;
                secondsFiring += timeStep;
                shotsFired += fireRate * timeStep;
                shotCount += fireRate * timeStep;

                if (shotsFired >= clipAmmo) {
                    secondsReloading += reloadTime;
                    time += reloadTime;
                    shotsFired -= clipAmmo;
                    reloadCount++;
                }

                const damagePerStep = effectiveDamage * fireRate * timeStep;
                totalDamage += damagePerStep;
                currentArmor = Math.max(0, Math.min(armor, currentArmor + armorRegen * timeStep - damagePerStep));
                const damageToHP = Math.max(0, damagePerStep - (armorRegen * timeStep + currentArmor));
                currentHP = Math.max(0, currentHP + healthRegen * timeStep - damageToHP);

                dataPoints.push({ time: time.toFixed(2), hp: currentHP, armor: currentArmor });
            }

            const ttk = currentHP <= 0 ? dataPoints[dataPoints.length - 1].time : "No mata";
            document.getElementById('result').innerHTML = `TTK (hasta 60s): ${ttk} segundos`;

            // Estadísticas detalladas
            const effectiveAccuracy = (accuracy * hitChance * 100).toFixed(2);
            const sustainedDPS = totalDamage / (secondsFiring + secondsReloading);
            const burstDPS = effectiveDamage * fireRate;
            document.getElementById('stats').innerHTML = `
                Segundos Disparando: ${secondsFiring.toFixed(2)} s<br>
                Segundos Recargando: ${secondsReloading.toFixed(2)} s<br>
                Cantidad de Disparos: ${Math.round(shotCount)}<br>
                Cantidad de Recargas: ${reloadCount}<br>
                Precisión Efectiva: ${effectiveAccuracy}%<br>
                DPS Sostenido: ${sustainedDPS.toFixed(2)}<br>
                DPS de Ráfaga: ${burstDPS.toFixed(2)}<br>
                Daño Total Infligido: ${totalDamage.toFixed(2)}
            `;

            drawChart(dataPoints);
        }

        function drawChart(dataPoints) {
            const ctx = document.getElementById('ttkChart').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dataPoints.map(d => d.time),
                    datasets: [
                        { label: 'Salud (HP)', data: dataPoints.map(d => d.hp), borderColor: '#00ff99', fill: false },
                        { label: 'Armadura', data: dataPoints.map(d => d.armor), borderColor: '#ffcc00', fill: false }
                    ]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Valor', color: '#ddd' } },
                        x: { title: { display: true, text: 'Tiempo (s)', color: '#ddd' } }
                    },
                    plugins: { legend: { labels: { color: '#ddd' } } }
                }
            });
            document.getElementById('chartExplanation').innerHTML = "Gráfico: Muestra salud (verde) y armadura (amarillo) hasta 60s. TTK Teórico da el tiempo real o infinito.";
        }

        function exportResults() {
            const data = {
                shooter: {
                    accuracy: document.getElementById('accuracy').value,
                    spreadReduction: document.getElementById('spreadReduction').value,
                    damageBoost: document.getElementById('damageBoost').value,
                    fireRateBoost: document.getElementById('fireRateBoost').value,
                    reloadReduction: document.getElementById('reloadReduction').value,
                    ammoBoost: document.getElementById('ammoBoost').value
                },
                gun: {
                    damage: document.getElementById('damage').value,
                    fireRate: document.getElementById('fireRate').value,
                    fireRateUnit: document.getElementById('fireRateUnit').value,
                    spread: document.getElementById('spread').value,
                    clipAmmo: document.getElementById('clipAmmo').value,
                    reloadTime: document.getElementById('reloadTime').value
                },
                target: {
                    distance: document.getElementById('distance').value,
                    width: document.getElementById('width').value,
                    height: document.getElementById('height').value,
                    hp: document.getElementById('hp').value,
                    armor: document.getElementById('armor').value,
                    armorAbsorption: document.getElementById('armorAbsorption').value,
                    healthRegen: document.getElementById('healthRegen').value,
                    armorRegen: document.getElementById('armorRegen').value,
                    damageReduction: document.getElementById('damageReduction').value
                },
                ttk: document.getElementById('result').textContent,
                theoreticalTTK: document.getElementById('theoreticalTTK').textContent,
                stats: document.getElementById('stats').textContent
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ttk_results.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetData() {
            document.getElementById('accuracy').value = 100;
            document.getElementById('spreadReduction').value = 0;
            document.getElementById('damageBoost').value = 0;
            document.getElementById('fireRateBoost').value = 0;
            document.getElementById('reloadReduction').value = 0;
            document.getElementById('ammoBoost').value = 0;

            document.getElementById('damage').value = 10;
            document.getElementById('fireRate').value = 60;
            document.getElementById('fireRateUnit').value = 'rpm';
            document.getElementById('spread').value = 0;
            document.getElementById('clipAmmo').value = 30;
            document.getElementById('reloadTime').value = 2;

            document.getElementById('distance').value = 10;
            document.getElementById('width').value = 0.5;
            document.getElementById('height').value = 1.8;
            document.getElementById('hp').value = 100;
            document.getElementById('armor').value = 0;
            document.getElementById('armorAbsorption').value = 0;
            document.getElementById('healthRegen').value = 0;
            document.getElementById('armorRegen').value = 0;
            document.getElementById('damageReduction').value = 0;

            document.getElementById('result').innerHTML = '';
            document.getElementById('theoreticalTTK').innerHTML = '';
            document.getElementById('stats').innerHTML = '';
            if (chart) chart.destroy();
            document.getElementById('chartExplanation').innerHTML = '';
        }
    </script>
</body>
</html>
